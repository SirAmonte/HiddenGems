@using HiddenGems.Domain.Entities
@model HiddenGems.WebUI.ViewModels.ListGemViewModel
@{
	ViewData["Title"] = "Favorieten";
}

<h2>Favorieten</h2>

<hr/>

<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
    @foreach (var gem in Model.Gems)
    {
        var gemRatings = Model.Ratings.Where(r => r.GemId == gem.Id).ToList();
        var avgRating = gemRatings.Any() ? gemRatings.Average(r => r.Stars) : 0;
        var countRating = gemRatings.Count();
        var isFavorite = Model.UserFavorites?.Contains(gem.Id) ?? false;

        <div class="col">
            <div class="card hover-card h-100">
                <div class="position-absolute end-0 p-2">
                    <form asp-controller="Favorite" asp-action="ToggleFavorite" method="post">
                        <input type="hidden" name="gemId" value="@gem.Id" />
                        <button type="submit" class="btn btn-sm p-0">
                            @if (isFavorite)
                            {
                                <i class="bi bi-heart-fill text-danger fs-5"></i>
                            }
                            else
                            {
                                <i class="bi bi-heart fs-5"></i>
                            }
                        </button>
                    </form>
                </div>
                <img class="card-img-top" src="@gem.ImageUrl" alt="Afbeelding van @gem.Name" style="object-fit: cover; height: 200px;" />
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">@gem.Name</h5>

                    <p class="text-muted mb-2 d-flex align-items-center">
                        @for (int i = 1; i <= 5; i++)
                        {
                            if (i <= Math.Round(avgRating))
                            {
                                <span class="text-warning me-1">&#9733;</span>
                            }
                            else
                            {
                                <span class="text-muted me-1">&#9734;</span>
                            }
                        }
                        <small class="ms-2">(@countRating review@(countRating == 1 ? "" : "s"))</small>
                    </p>

                    <p class="card-text text-muted mb-3">@gem.Street @gem.Number, @gem.City</p>

                    <a href="@Url.Action("Details", "Gem", new { id = gem.Id })" class="btn btn-outline-primary mt-auto">Details</a>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .hover-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .hover-card:hover {
        transform: scale(1.03);
        box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }
</style>

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
